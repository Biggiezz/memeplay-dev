<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Template Registry</title>
  <style>
    body {
      font-family: monospace;
      background: #0d0d17;
      color: #e5e7eb;
      padding: 20px;
    }
    .test-result {
      background: #111827;
      border: 1px solid #1f2937;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    .success { border-color: #7ad957; }
    .error { border-color: #ef4444; }
    pre {
      background: #0f172a;
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
    }
    button {
      background: #ffb642;
      color: #1f1300;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin: 8px 8px 8px 0;
    }
    button:hover { opacity: 0.9; }
  </style>
</head>
<body>
  <h1>üß™ Template Registry Test</h1>
  
  <div>
    <button onclick="testGetConfig()">Test: Get Template Config</button>
    <button onclick="testGetEnabled()">Test: Get Enabled Templates</button>
    <button onclick="testLoadAdapter()">Test: Load Adapter</button>
    <button onclick="testHelpers()">Test: Helper Functions</button>
    <button onclick="runAllTests()">Run All Tests</button>
  </div>

  <div id="results"></div>

  <script type="module">
    import { 
      TEMPLATE_REGISTRY,
      getTemplateConfig,
      getEnabledTemplates,
      loadAdapter,
      getPlaytestKey,
      getPlaytestGameId,
      getTemplateUrl,
      getMessageType
    } from './core/template-registry.js';

    window.TEMPLATE_REGISTRY = TEMPLATE_REGISTRY;
    window.getTemplateConfig = getTemplateConfig;
    window.getEnabledTemplates = getEnabledTemplates;
    window.loadAdapter = loadAdapter;
    window.getPlaytestKey = getPlaytestKey;
    window.getPlaytestGameId = getPlaytestGameId;
    window.getTemplateUrl = getTemplateUrl;
    window.getMessageType = getMessageType;

    function addResult(title, success, data = null) {
      const results = document.getElementById('results');
      const div = document.createElement('div');
      div.className = `test-result ${success ? 'success' : 'error'}`;
      div.innerHTML = `
        <h3>${success ? '‚úÖ' : '‚ùå'} ${title}</h3>
        ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
      `;
      results.appendChild(div);
    }

    window.testGetConfig = () => {
      document.getElementById('results').innerHTML = '';
      
      // Test 1: Get pacman config
      const pacman = getTemplateConfig('pacman');
      addResult('Get Pacman Config', !!pacman && pacman.displayName === 'Pacman', pacman);
      
      // Test 2: Get invalid template
      const invalid = getTemplateConfig('invalid-template');
      addResult('Get Invalid Template (should return null)', invalid === null, { result: invalid });
      
      // Test 3: Check required fields
      if (pacman) {
        const hasRequired = 
          pacman.playtestKey &&
          pacman.playtestGameId &&
          pacman.templateUrl &&
          pacman.messageTypes &&
          pacman.uiFields;
        addResult('Pacman Config Has Required Fields', hasRequired, {
          playtestKey: pacman.playtestKey,
          playtestGameId: pacman.playtestGameId,
          templateUrl: pacman.templateUrl,
          hasMessageTypes: !!pacman.messageTypes,
          hasUiFields: !!pacman.uiFields
        });
      }
    };

    window.testGetEnabled = () => {
      document.getElementById('results').innerHTML = '';
      
      const enabled = getEnabledTemplates();
      addResult('Get Enabled Templates', enabled.length > 0, {
        count: enabled.length,
        templates: enabled.map(t => ({ id: t.id, displayName: t.displayName }))
      });
    };

    window.testLoadAdapter = async () => {
      document.getElementById('results').innerHTML = '';
      
      try {
        const AdapterClass = await loadAdapter('pacman');
        const isClass = typeof AdapterClass === 'function';
        addResult('Load Pacman Adapter', isClass, {
          isClass,
          name: AdapterClass?.name || 'unknown'
        });
      } catch (error) {
        addResult('Load Pacman Adapter', false, { error: error.message });
      }
      
      // Test invalid template
      try {
        await loadAdapter('invalid-template');
        addResult('Load Invalid Template (should fail)', false, { error: 'Should have thrown' });
      } catch (error) {
        addResult('Load Invalid Template (should fail)', true, { error: error.message });
      }
    };

    window.testHelpers = () => {
      document.getElementById('results').innerHTML = '';
      
      // Test getPlaytestKey
      const playtestKey = getPlaytestKey('pacman');
      addResult('Get Playtest Key', playtestKey === 'pacman_brand_config_playtest', { playtestKey });
      
      // Test getPlaytestGameId
      const gameId = getPlaytestGameId('pacman');
      addResult('Get Playtest GameId', gameId === 'playtest-pacman', { gameId });
      
      // Test getTemplateUrl
      const url1 = getTemplateUrl('pacman');
      const url2 = getTemplateUrl('pacman', 'playtest-pacman');
      addResult('Get Template URL', 
        url1 === '/games/templates-v2/pacman-template/index.html' &&
        url2 === '/games/templates-v2/pacman-template/index.html?game=playtest-pacman',
        { url1, url2 }
      );
      
      // Test getMessageType
      const readyType = getMessageType('pacman', 'READY');
      const errorType = getMessageType('pacman', 'ERROR');
      addResult('Get Message Types', 
        readyType === 'PACMAN_GAME_READY' && errorType === 'PACMAN_GAME_ERROR',
        { READY: readyType, ERROR: errorType }
      );
    };

    window.runAllTests = () => {
      document.getElementById('results').innerHTML = '';
      testGetConfig();
      setTimeout(() => testGetEnabled(), 100);
      setTimeout(() => testLoadAdapter(), 200);
      setTimeout(() => testHelpers(), 300);
    };

    // Auto-run on load
    console.log('‚úÖ Template Registry loaded. Click buttons to test.');
  </script>
</body>
</html>


